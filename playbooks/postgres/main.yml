---
- hosts: db
  become: true  # you need sudo

  vars_files:
  - vars.yml

  handlers:
  - name: restart postgresql
    service:
      name: "{{ postgresql_daemon }}"
      state: "{{ postgresql_restarted_state }}"

  pre_tasks:
  - name: package update (apt)
    apt: update_cache=yes cache_valid_time=3600

  roles:
  - role: geerlingguy.postgresql

  tasks:
  - name: Set Postgresql config listening to all addresses 
    lineinfile:
      path: "/etc/postgresql/9.5/main/postgresql.conf"
      regexp: "#listen_addresses = 'localhost'"
      line: "listen_addresses = '*'"
    notify: restart postgresql
